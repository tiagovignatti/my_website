<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Moving the mouse handling code into a separate thread - Tiago Vignatti</title><meta name="Description" content=""><meta property="og:title" content="Moving the mouse handling code into a separate thread" />
<meta property="og:description" content="(In a puny attempt to write my SoC project progress to my mentor, I decided to expand it and share my thoughts with you)
Today, we have two methods to register the pointer devices on Xorg server: (1) under SIGIO and (2) put they fd on EnableDevices set. There is also the silken mouse concept, which means updates fired during sigio handler (in the case of hw cursor).
We always try to prioritize silken - i." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vignatti.com/posts/moving-the-mouse-handling-code-into-a-separate-thread/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2007-06-16T19:12:23+00:00" />
<meta property="article:modified_time" content="2007-06-16T19:12:23+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Moving the mouse handling code into a separate thread"/>
<meta name="twitter:description" content="(In a puny attempt to write my SoC project progress to my mentor, I decided to expand it and share my thoughts with you)
Today, we have two methods to register the pointer devices on Xorg server: (1) under SIGIO and (2) put they fd on EnableDevices set. There is also the silken mouse concept, which means updates fired during sigio handler (in the case of hw cursor).
We always try to prioritize silken - i."/>
<meta name="application-name" content="Tiago Vignatti">
<meta name="apple-mobile-web-app-title" content="Tiago Vignatti"><link rel="shortcut icon" type="image/x-icon" href="https://vignatti.com/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="https://vignatti.com/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://vignatti.com/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="https://vignatti.com/apple-touch-icon.png"><link rel="manifest" href="https://vignatti.com/site.webmanifest"><link rel="canonical" href="https://vignatti.com/posts/moving-the-mouse-handling-code-into-a-separate-thread/" /><link rel="prev" href="https://vignatti.com/posts/multiseat-input-hotplug/" /><link rel="next" href="https://vignatti.com/posts/xorg-input-thread-summary-or-something/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Moving the mouse handling code into a separate thread",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/vignatti.com\/posts\/moving-the-mouse-handling-code-into-a-separate-thread\/"
        },"genre": "posts","wordcount":  477 ,
        "url": "https:\/\/vignatti.com\/posts\/moving-the-mouse-handling-code-into-a-separate-thread\/","datePublished": "2007-06-16T19:12:23+00:00","dateModified": "2007-06-16T19:12:23+00:00","publisher": {
            "@type": "Organization",
            "name": "Author"},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Tiago Vignatti">
                
            </a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Blog </a><a class="menu-item" href="/projects/"> Projects </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                .
                
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Blog</a><a class="menu-item" href="/projects/" title="">Projects</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Moving the mouse handling code into a separate thread</h1><div class="post-meta">
            <div class="post-meta-line">&nbsp;<span class="post-category">included in <a href="/categories/computing/"><i class="far fa-folder fa-fw"></i>Computing</a>&nbsp;<a href="/categories/soc2007/"><i class="far fa-folder fa-fw"></i>Soc2007</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2007-06-16">2007-06-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;477 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
            </div><div class="content" id="content"><p>(In a puny attempt to write my SoC project progress to my mentor, I
decided to expand it and share my thoughts with you)</p>
<p>Today, we have two methods to register the pointer devices on <strong>Xorg
server</strong>: (1) under SIGIO and (2) put they fd on EnableDevices set.
There is also the silken mouse concept, which means updates fired during
sigio handler (in the case of hw cursor).</p>
<p>We always try to prioritize silken - i.e. when the device emits a move
event, it will be &ldquo;painted&rdquo; on the screen and the WaitFor loop still
continue sleeping on select() - But the problem with SIGIO is that it
can blocks if the main thread is wedged doing kernel stuff (like
paging). It can&rsquo;t interrupt a program in D state.</p>
<p>So, the basically idea is to do a separate thread which takes care the
mouse handling code without using SIGIO. I did an approach and some
questions were raised up:</p>
<p>(1) With (silken/hw cursor) or without the input thread  seems to be
equal in perfomance (tested with three video cards: ATI Rage XL, GeForce
FX 5500 and GeForce2 MX/MX 400). I&rsquo;d tested with a gnome-session started
and ran &lsquo;x11perf -putimagexy500&rsquo;. The cursor never lag the mouse in both
situations. At least no performance regressions  :)  Fine.</p>
<p>(2) But I think that (1) is not the exactly problem which we&rsquo;re trying
to solve. Daniel Stone said once to me that having a tiny footprint that
needs to be kept in memory, it wouldn&rsquo;t need to wait to be paged into
the active set all the time. Here Daniel&rsquo;s transcription: &ldquo;Currently it
works <em>almost</em> like this, but SIGIO is in the same process, with a very
large memory footprint.  So if any part of the X server is waiting to be
paged in to memory, then you&rsquo;ll be completely blocked on disk I/O.  This
is the problem we have today: under heavy disk and memory loads, we end
up blocked on I/O. OTOH, the input thread won&rsquo;t get paged out, because
its active set will be extremely small&rdquo;. But how to keep this resident?
Is it inner to the thread?</p>
<p>(3) Another thing that is breaking my head is to not have such a
mechanism to do a real performance test. How to know if the thread has
advanced or not the overall performance? Maybe using the &rsquo;time&rsquo; tool?
Maybe something with xtest? I don&rsquo;t know.</p>
<p>(4) So far I&rsquo;m not facing any problem concerning the thread safety.
Yesterday, on the IRC, Mercury and Clee tell me to test the input
thread on SMP machines to really do it parallelized. I haven&rsquo;t done it
yet. Some another tips here?</p>
<p>The input thread (using clone syscall) is on my Linux machine. The patch
applies with the last git evdev and xserver. You can see it here:</p>
<p><a href="http://web.inf.ufpr.br/vignatti/tmp/xorg-input-thread.diff" target="_blank" rel="noopener noreffer">http://web.inf.ufpr.br/vignatti/tmp/xorg-input-thread.diff</a></p>
<p>I&rsquo;ll really appreciate comments.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2007-06-16</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/multiseat-input-hotplug/" class="prev" rel="prev" title="multiseat input hotplug"><i class="fas fa-angle-left fa-fw"></i>multiseat input hotplug</a>
            <a href="/posts/xorg-input-thread-summary-or-something/" class="next" rel="next" title="Xorg input thread - summary or something">Xorg input thread - summary or something<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.112.7">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-C1XH4SJP6N', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-C1XH4SJP6N" async></script></body>
</html>
